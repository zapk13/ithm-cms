<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Detail - ITHM CMS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../assets/css/tailwind-built.css">
    <script src="../assets/js/demo-data.js"></script>
    <script src="../assets/js/navigation.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-indigo-600">ITHM CMS</h1>
                    </div>
                    <nav class="hidden md:ml-10 md:flex md:space-x-8">
                        <a href="dashboard.html" class="text-gray-500 hover:text-gray-700 px-1 pt-1 text-sm font-medium">Dashboard</a>
                        <a href="admission-management.html" class="text-indigo-600 border-b-2 border-indigo-600 px-1 pt-1 text-sm font-medium">Admissions</a>
                        <a href="user-management.html" class="text-gray-500 hover:text-gray-700 px-1 pt-1 text-sm font-medium">Users</a>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Welcome, <span class="user-info font-medium">Loading...</span></span>
                    <span class="text-xs text-gray-500 user-role">Loading...</span>
                    <button onclick="navigationManager.logout()" class="logout-btn text-sm text-gray-500 hover:text-gray-700">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Page Header -->
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 shadow-xl rounded-2xl border border-indigo-200 mb-8">
            <div class="px-6 py-8">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="mb-4 lg:mb-0">
                        <div class="flex items-center space-x-3 mb-2">
                            <div class="w-12 h-12 bg-indigo-500 rounded-xl flex items-center justify-center shadow-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-gray-900">Application Detail</h1>
                                <p class="text-sm text-gray-600 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Review and manage admission application
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                        <button onclick="goBack()" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            Back to Admissions
                        </button>
                        <button onclick="updateApplicationStatus('accepted')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Accept Application
                        </button>
                        <button onclick="updateApplicationStatus('rejected')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Reject Application
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application Information -->
        <div id="application-detail" class="space-y-6">
            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                <p class="mt-2 text-gray-600">Loading application details...</p>
            </div>

            <!-- Application Content (will be populated by JavaScript) -->
            <div id="application-content" class="hidden">
                <!-- Application will be populated here -->
            </div>
        </div>
    </main>

    <!-- Status Update Modal -->
    <div id="statusUpdateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Update Application Status</h3>
                    <button onclick="closeStatusModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <form id="statusUpdateForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">New Status</label>
                        <select id="newStatus" name="status" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="pending_review">Pending Review</option>
                            <option value="under_review">Under Review</option>
                            <option value="accepted">Accepted</option>
                            <option value="rejected">Rejected</option>
                            <option value="waitlisted">Waitlisted</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Comments/Notes</label>
                        <textarea id="statusComments" name="comments" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Add any comments or notes about this status change..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeStatusModal()" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Update Status
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentApplication = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadApplicationDetail();
        });

        function loadApplicationDetail() {
            // Get application ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const applicationId = urlParams.get('id');
            
            if (!applicationId) {
                showError('No application ID provided');
                return;
            }

            // Find application in demo data
            const application = demoData.admissionForms.find(app => app.id === applicationId);
            
            if (!application) {
                showError('Application not found');
                return;
            }

            currentApplication = application;
            displayApplication(application);
        }

        function displayApplication(app) {
            const intake = demoData.admissionIntakes.find(i => i.id === app.intake_id);
            const course = demoData.courses.find(c => c.id === intake?.course_id);
            const campus = demoData.campuses.find(c => c.id === intake?.campus_id);

            const content = `
                <!-- Application Header -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-xl font-semibold text-gray-900">Application #${app.id}</h2>
                                <p class="text-sm text-gray-600">Submitted on ${formatDate(app.submitted_at)}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full ${getStatusBadgeClass(app.status)}">
                                    ${app.status.replace('_', ' ').charAt(0).toUpperCase() + app.status.replace('_', ' ').slice(1)}
                                </span>
                                <p class="text-xs text-gray-500 mt-1">${app.submission_type === 'in_person' ? 'In-Person Submission' : 'Online Submission'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Personal Information</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                <p class="mt-1 text-sm text-gray-900">${app.personal_info?.full_name || app.student_name || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Email</label>
                                <p class="mt-1 text-sm text-gray-900">${app.student_email || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Phone</label>
                                <p class="mt-1 text-sm text-gray-900">${app.personal_info?.phone || app.student_phone || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">CNIC</label>
                                <p class="mt-1 text-sm text-gray-900">${app.personal_info?.cnic || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
                                <p class="mt-1 text-sm text-gray-900">${app.personal_info?.date_of_birth || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Gender</label>
                                <p class="mt-1 text-sm text-gray-900">${app.personal_info?.gender || 'N/A'}</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">Address</label>
                            <p class="mt-1 text-sm text-gray-900">${app.personal_info?.address || 'N/A'}</p>
                        </div>
                    </div>
                </div>

                <!-- Passport Photo -->
                ${app.passport_photo ? `
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Passport Photo</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <img src="${app.passport_photo}" alt="Passport Photo" class="h-32 w-32 rounded-lg object-cover border-2 border-gray-200">
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Passport size photo uploaded by applicant</p>
                                <button onclick="viewFullImage('${app.passport_photo}')" class="mt-2 inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                    </svg>
                                    View Full Size
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Guardian Information -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Guardian Information</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Guardian Name</label>
                                <p class="mt-1 text-sm text-gray-900">${app.guardian_info?.guardian_name || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Relation</label>
                                <p class="mt-1 text-sm text-gray-900">${app.guardian_info?.guardian_relation || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Guardian Phone</label>
                                <p class="mt-1 text-sm text-gray-900">${app.guardian_info?.guardian_phone || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Occupation</label>
                                <p class="mt-1 text-sm text-gray-900">${app.guardian_info?.guardian_occupation || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Information -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Academic Information</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Matric Marks</label>
                                <p class="mt-1 text-sm text-gray-900">${app.academic_info?.matric_marks || 'N/A'} / ${app.academic_info?.matric_total || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Intermediate Marks</label>
                                <p class="mt-1 text-sm text-gray-900">${app.academic_info?.intermediate_marks || 'N/A'} / ${app.academic_info?.intermediate_total || 'N/A'}</p>
                            </div>
                            ${app.academic_info?.bachelor_degree ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Bachelor's Degree</label>
                                <p class="mt-1 text-sm text-gray-900">${app.academic_info.bachelor_degree} - ${app.academic_info.bachelor_institution} (${app.academic_info.bachelor_year})</p>
                                <p class="text-xs text-gray-500">CGPA: ${app.academic_info.bachelor_cgpa}</p>
                            </div>
                            ` : ''}
                            ${app.academic_info?.master_degree ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Master's Degree</label>
                                <p class="mt-1 text-sm text-gray-900">${app.academic_info.master_degree} - ${app.academic_info.master_institution} (${app.academic_info.master_year})</p>
                                <p class="text-xs text-gray-500">CGPA: ${app.academic_info.master_cgpa}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- Distinctions and Achievements -->
                ${app.distinctions && app.distinctions.length > 0 ? `
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Distinctions and Achievements</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="space-y-4">
                            ${app.distinctions.map(distinction => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="text-sm font-medium text-gray-900">${distinction.title}</h4>
                                        <p class="text-sm text-gray-600 mt-1">${distinction.description}</p>
                                        <p class="text-xs text-gray-500 mt-2">Awarded: ${distinction.year || 'N/A'}</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                        ${distinction.level || 'Achievement'}
                                    </span>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Certificates and Trainings -->
                ${app.certificates && app.certificates.length > 0 ? `
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Certificates and Trainings</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="space-y-4">
                            ${app.certificates.map(cert => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="text-sm font-medium text-gray-900">${cert.name}</h4>
                                        <p class="text-sm text-gray-600 mt-1">${cert.issuing_organization}</p>
                                        <p class="text-xs text-gray-500 mt-2">Issued: ${cert.issue_date || 'N/A'} | Valid: ${cert.valid_until || 'N/A'}</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                        ${cert.status || 'Valid'}
                                    </span>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Previous Studentship -->
                ${app.previous_studentship && app.previous_studentship.length > 0 ? `
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Previous Studentship</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="space-y-4">
                            ${app.previous_studentship.map(prev => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="text-sm font-medium text-gray-900">${prev.institution}</h4>
                                        <p class="text-sm text-gray-600 mt-1">${prev.program} - ${prev.degree}</p>
                                        <p class="text-xs text-gray-500 mt-2">Period: ${prev.start_date || 'N/A'} to ${prev.end_date || 'N/A'}</p>
                                        <p class="text-xs text-gray-500">Status: ${prev.status || 'N/A'}</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${prev.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                        ${prev.status || 'Unknown'}
                                    </span>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Documents Uploaded -->
                ${app.documents && app.documents.length > 0 ? `
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Uploaded Documents</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${app.documents.map(doc => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0">
                                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-gray-900 truncate">${doc.name}</p>
                                        <p class="text-xs text-gray-500">${doc.type || 'Document'}</p>
                                        <p class="text-xs text-gray-400">${doc.size || 'Unknown size'}</p>
                                    </div>
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button onclick="viewDocument('${doc.url}')" class="text-xs text-indigo-600 hover:text-indigo-900">View</button>
                                    <button onclick="downloadDocument('${doc.url}', '${doc.name}')" class="text-xs text-green-600 hover:text-green-900">Download</button>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Application Details -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Application Details</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Intake</label>
                                <p class="mt-1 text-sm text-gray-900">${intake?.name || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Course</label>
                                <p class="mt-1 text-sm text-gray-900">${course?.name || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Campus</label>
                                <p class="mt-1 text-sm text-gray-900">${campus?.name || 'N/A'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Submitted By</label>
                                <p class="mt-1 text-sm text-gray-900">${app.submitted_by === 'admin' ? 'Admin Staff' : 'Student'}</p>
                            </div>
                        </div>
                        ${app.admin_notes ? `
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">Admin Notes</label>
                            <p class="mt-1 text-sm text-gray-900">${app.admin_notes}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Timeline -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Application Timeline</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="flow-root">
                            <ul class="-mb-8">
                                ${(app.timeline || []).map((item, index) => `
                                <li>
                                    <div class="relative pb-8">
                                        ${index < (app.timeline || []).length - 1 ? '<div class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"></div>' : ''}
                                        <div class="relative flex space-x-3">
                                            <div>
                                                <span class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center ring-8 ring-white">
                                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                                    </svg>
                                                </span>
                                            </div>
                                            <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                <div>
                                                    <p class="text-sm text-gray-500">${item.action}</p>
                                                    <p class="text-xs text-gray-400">${item.notes || ''}</p>
                                                </div>
                                                <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                                    <time>${formatDate(item.timestamp)}</time>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('application-content').innerHTML = content;
            document.getElementById('application-content').classList.remove('hidden');
        }

        function updateApplicationStatus(status) {
            document.getElementById('newStatus').value = status;
            document.getElementById('statusUpdateModal').classList.remove('hidden');
        }

        function closeStatusModal() {
            document.getElementById('statusUpdateModal').classList.add('hidden');
            document.getElementById('statusUpdateForm').reset();
        }

        function goBack() {
            window.location.href = 'admission-management.html';
        }

        function showError(message) {
            document.getElementById('loading-state').innerHTML = `
                <div class="text-center py-12">
                    <div class="text-red-600 text-6xl mb-4">⚠️</div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Error</h3>
                    <p class="text-gray-600">${message}</p>
                    <button onclick="goBack()" class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        Go Back
                    </button>
                </div>
            `;
        }

        // Handle status update form submission
        document.getElementById('statusUpdateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const newStatus = formData.get('status');
            const comments = formData.get('comments');
            
            if (currentApplication) {
                // Update application status
                currentApplication.status = newStatus;
                
                // Add timeline entry
                if (!currentApplication.timeline) {
                    currentApplication.timeline = [];
                }
                
                currentApplication.timeline.push({
                    action: `Status changed to ${newStatus.replace('_', ' ')}`,
                    user: 'Admin',
                    timestamp: new Date().toISOString(),
                    status: newStatus,
                    notes: comments || 'Status updated by admin'
                });
                
                // Update demo data
                const appIndex = demoData.admissionForms.findIndex(app => app.id === currentApplication.id);
                if (appIndex !== -1) {
                    demoData.admissionForms[appIndex] = currentApplication;
                }
                
                // Show success notification
                if (typeof showNotification === 'function') {
                    showNotification('Application status updated successfully!', 'success');
                } else {
                    alert('Application status updated successfully!');
                }
                
                // Close modal and refresh display
                closeStatusModal();
                displayApplication(currentApplication);
            }
        });

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        function getStatusBadgeClass(status) {
            const statusClasses = {
                'pending_review': 'bg-yellow-100 text-yellow-800',
                'under_review': 'bg-blue-100 text-blue-800',
                'accepted': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800',
                'waitlisted': 'bg-purple-100 text-purple-800'
            };
            return statusClasses[status] || 'bg-gray-100 text-gray-800';
        }

        function viewFullImage(imageUrl) {
            // Create modal for full image view
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full p-4">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-2 right-2 text-white hover:text-gray-300 z-10">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <img src="${imageUrl}" alt="Full size image" class="max-w-full max-h-full rounded-lg shadow-2xl">
                </div>
            `;
            document.body.appendChild(modal);
        }

        function viewDocument(documentUrl) {
            // Open document in new tab
            window.open(documentUrl, '_blank');
        }

        function downloadDocument(documentUrl, fileName) {
            // Create download link
            const link = document.createElement('a');
            link.href = documentUrl;
            link.download = fileName;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
