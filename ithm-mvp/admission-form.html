<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admission Form - ITHM CMS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ithm-primary': '#4f46e5',
                        'ithm-secondary': '#7c3aed',
                        'ithm-success': '#059669',
                        'ithm-warning': '#d97706',
                        'ithm-danger': '#dc2626',
                        'ithm-info': '#0891b2'
                    }
                }
            }
        }
        
    </script>
    <!-- <link rel="stylesheet" href="assets/css/tailwind-built.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.min.js"></script>
    <script src="assets/js/demo-data.js"></script>
    <script src="assets/js/navigation.js"></script>
</head>
<body class="bg-gray-50">
    <script>
        // Check user role and access permissions
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('demoUser') || '{}');
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            
            // Check if user has access to admission form
            if (!currentUser.role || (!['student', 'admin', 'super_admin'].includes(currentUser.role))) {
                showNotification('Access denied. You do not have permission to access this page.', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }
            
            // Set form mode based on user role
            if (currentUser.role === 'admin' || currentUser.role === 'super_admin') {
                setupAdminMode();
            } else {
                setupStudentMode();
            }
        });
        
        function setupAdminMode() {
            // Admin can fill form for any student
            document.title = 'Admission Form - Admin Mode';
            const header = document.querySelector('header h1');
            if (header) {
                header.textContent = 'Admission Form - Admin Mode';
            }
            
            // Add student selection dropdown
            const form = document.querySelector('form');
            if (form) {
                const studentSelect = document.createElement('div');
                studentSelect.className = 'mb-6';
                studentSelect.innerHTML = `
                    <label for="studentSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Student</label>
                    <select id="studentSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">-- Select a Student --</option>
                    </select>
                `;
                form.insertBefore(studentSelect, form.firstChild);
                
                // Populate student dropdown
                populateStudentDropdown();
            }
        }
        
        function setupStudentMode() {
            // Student fills form for themselves
            document.title = 'Admission Form - Student Mode';
        }
        
        function populateStudentDropdown() {
            const select = document.getElementById('studentSelect');
            if (select && typeof demoData !== 'undefined' && demoData.users) {
                demoData.users.filter(user => user.role === 'student').forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.first_name} ${student.last_name} (${student.email})`;
                    select.appendChild(option);
                });
            }
        }
    </script>
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-indigo-600">ITHM CMS</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="generatePDF()" class="bg-blue-600 text-white px-6 py-3 rounded-xl text-sm font-semibold hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Generate PDF
                    </button>
                    <button onclick="testPhotoUpload()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-green-700 transition-all duration-200">
                        Test Photo
                    </button>
                    <button onclick="testSimplePDF()" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-purple-700 transition-all duration-200">
                        Test PDF
                    </button>
                    <button onclick="generateHTMLPDF()" class="bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-orange-700 transition-all duration-200">
                        HTML PDF
                    </button>
                    <button onclick="saveForm()" class="bg-green-600 text-white px-6 py-3 rounded-xl text-sm font-semibold hover:bg-green-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                        Save Form
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Form Header -->
        <div class="bg-white shadow rounded-lg mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h1 class="text-2xl font-bold text-gray-900">Admission Application Form</h1>
                <p class="text-gray-600 mt-1">Institute of Tourism and Hospitality Management</p>
                <div class="mt-4 flex items-center space-x-4">
                    <span class="text-sm text-gray-500">Application ID: <span id="application-id">ADM2024001</span></span>
                    <span class="text-sm text-gray-500">Status: <span id="application-status" class="text-yellow-600">Draft</span></span>
                </div>
            </div>
        </div>

        <form id="admissionForm" class="space-y-8">
            <!-- Personal Information -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">Personal Information</h2>
                </div>
                <div class="px-6 py-4 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Full Name *</label>
                            <input type="text" name="full_name" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">CNIC *</label>
                            <input type="text" name="cnic" placeholder="12345-1234567-1" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Date of Birth *</label>
                            <input type="date" name="date_of_birth" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Gender *</label>
                            <select name="gender" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Phone *</label>
                            <input type="tel" name="phone" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Email *</label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-800">Address *</label>
                        <textarea name="address" rows="3" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400 resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- Guardian Information -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">Guardian Information</h2>
                </div>
                <div class="px-6 py-4 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Guardian Name *</label>
                            <input type="text" name="guardian_name" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Relation *</label>
                            <select name="guardian_relation" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800">
                                <option value="">Select Relation</option>
                                <option value="Father">Father</option>
                                <option value="Mother">Mother</option>
                                <option value="Brother">Brother</option>
                                <option value="Sister">Sister</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Guardian Phone *</label>
                            <input type="tel" name="guardian_phone" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-800">Occupation</label>
                            <input type="text" name="guardian_occupation" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white text-gray-800 placeholder-gray-400">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Information -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">Academic Information</h2>
                </div>
                <div class="px-6 py-4 space-y-6">
                    <!-- Matric -->
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold">1</span>
                            </span>
                            Matriculation
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Marks Obtained *</label>
                                <input type="number" name="matric_marks" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Total Marks *</label>
                                <input type="number" name="matric_total" value="1100" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Board *</label>
                                <input type="text" name="matric_board" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- Intermediate -->
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <span class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-green-600 font-bold">2</span>
                            </span>
                            Intermediate
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Marks Obtained *</label>
                                <input type="number" name="intermediate_marks" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Total Marks *</label>
                                <input type="number" name="intermediate_total" value="1100" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Board *</label>
                                <input type="text" name="intermediate_board" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- Bachelor's Degree -->
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <span class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-purple-600 font-bold">3</span>
                            </span>
                            Bachelor's Degree (if applicable)
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Degree Name</label>
                                <input type="text" name="bachelor_degree" placeholder="e.g., BSc Computer Science" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Institution</label>
                                <input type="text" name="bachelor_institution" placeholder="e.g., University of Lahore" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Year of Completion</label>
                                <input type="number" name="bachelor_year" placeholder="e.g., 2023" min="1990" max="2030" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">CGPA/GPA</label>
                                <input type="number" name="bachelor_cgpa" step="0.01" min="0" max="4" placeholder="e.g., 3.2" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- Master's Degree -->
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <span class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-orange-600 font-bold">4</span>
                            </span>
                            Master's Degree (if applicable)
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Degree Name</label>
                                <input type="text" name="master_degree" placeholder="e.g., MSc Computer Science" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Institution</label>
                                <input type="text" name="master_institution" placeholder="e.g., University of Punjab" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">Year of Completion</label>
                                <input type="number" name="master_year" placeholder="e.g., 2024" min="1990" max="2030" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-800">CGPA/GPA</label>
                                <input type="number" name="master_cgpa" step="0.01" min="0" max="4" placeholder="e.g., 3.5" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-white focus:bg-white text-gray-800 placeholder-gray-400">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Upload -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">Required Documents</h2>
                </div>
                <div class="px-6 py-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600">CNIC Copy</p>
                            <input type="file" accept=".pdf,.jpg,.png" class="mt-2">
                        </div>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600">Matric Certificate</p>
                            <input type="file" accept=".pdf,.jpg,.png" class="mt-2">
                        </div>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600">Intermediate Certificate</p>
                            <input type="file" accept=".pdf,.jpg,.png" class="mt-2">
                        </div>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600">Passport Size Photo</p>
                            <p class="text-xs text-gray-500 mt-1">Required for PDF generation</p>
                            <input type="file" accept=".jpg,.png" class="mt-2" id="passport-photo" onchange="previewPhoto(this)">
                            <div id="photo-preview" class="mt-2 hidden">
                                <img id="preview-img" class="w-16 h-16 object-cover rounded mx-auto border" alt="Photo preview">
                                <p class="text-xs text-green-600 mt-1">Photo uploaded successfully</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Undertaking -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">Declaration</h2>
                </div>
                <div class="px-6 py-4">
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <input type="checkbox" name="information_accurate" required class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label class="ml-2 text-sm text-gray-700">I declare that all information provided is accurate and complete.</label>
                        </div>
                        <div class="flex items-start">
                            <input type="checkbox" name="agree_to_terms" required class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label class="ml-2 text-sm text-gray-700">I agree to the terms and conditions of admission.</label>
                        </div>
                        <div class="flex items-start">
                            <input type="checkbox" name="agree_to_verification" required class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label class="ml-2 text-sm text-gray-700">I consent to verification of my documents and information.</label>
                        </div>
                    </div>
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700">Digital Signature</label>
                        <input type="text" name="digital_signature" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end space-x-4">
                <button type="button" onclick="saveForm()" class="px-8 py-4 border-2 border-gray-300 rounded-xl text-base font-semibold text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 shadow-sm hover:shadow-md">
                    Save Draft
                </button>
                <button type="submit" class="px-8 py-4 border-2 border-transparent rounded-xl text-base font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                    Submit Application
                </button>
            </div>
        </form>
    </main>

    <script>
        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            loadFormData();
            checkAdminMode();
        });

        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photo-preview');
                    const previewImg = document.getElementById('preview-img');
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                    
                    // Show success message
                    if (typeof showNotification === 'function') {
                        showNotification('Photo uploaded successfully! It will be included in the PDF.', 'success');
                    }
                    
                    // Debug: Log photo info
                    console.log('Photo uploaded:', {
                        name: input.files[0].name,
                        size: input.files[0].size,
                        type: input.files[0].type
                    });
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function checkAdminMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const isAdminMode = urlParams.get('mode') === 'admin';
            const isAdminFill = urlParams.get('admin_fill') === 'true';
            
            if (isAdminMode || isAdminFill) {
                // Update page title and header for admin mode
                document.title = 'Admin Admission Form - ITHM CMS';
                
                // Add admin mode indicator
                const header = document.querySelector('.px-6.py-4.border-b.border-gray-200');
                if (header) {
                    const adminIndicator = document.createElement('div');
                    adminIndicator.className = 'mt-4 p-3 bg-green-50 border border-green-200 rounded-lg';
                    adminIndicator.innerHTML = `
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-sm font-medium text-green-800">Admin Mode: Filling form on behalf of candidate</span>
                        </div>
                    `;
                    header.appendChild(adminIndicator);
                }
                
                // Update submit button text
                const submitButton = document.querySelector('button[type="submit"]');
                if (submitButton) {
                    submitButton.textContent = 'Submit on Behalf of Candidate';
                    submitButton.className = submitButton.className.replace('bg-indigo-600 hover:bg-indigo-700', 'bg-green-600 hover:bg-green-700');
                }
            }
        }

        function loadFormData() {
            // Load existing form data if available
            const urlParams = new URLSearchParams(window.location.search);
            const applicationId = urlParams.get('id');
            
            if (applicationId && demoData.admissionForms) {
                const application = demoData.admissionForms.find(app => app.id === applicationId);
                if (application) {
                    populateForm(application);
                }
            }
        }

        function populateForm(application) {
            // Populate form fields with application data
            const form = document.getElementById('admissionForm');
            const fields = form.querySelectorAll('input, select, textarea');
            
            fields.forEach(field => {
                const name = field.name;
                if (application.personal_info && application.personal_info[name]) {
                    field.value = application.personal_info[name];
                } else if (application.guardian_info && application.guardian_info[name]) {
                    field.value = application.guardian_info[name];
                } else if (application.academic_info && application.academic_info[name]) {
                    field.value = application.academic_info[name];
                } else if (application.undertaking && application.undertaking[name]) {
                    field.value = application.undertaking[name];
                }
            });
            
            document.getElementById('application-id').textContent = application.id;
            document.getElementById('application-status').textContent = application.status.replace('_', ' ').toUpperCase();
        }

        function saveForm() {
            const formData = new FormData(document.getElementById('admissionForm'));
            const data = Object.fromEntries(formData);
            
            // Save to localStorage
            localStorage.setItem('admissionFormDraft', JSON.stringify(data));
            
            if (typeof showNotification === 'function') {
                showNotification('Form saved as draft', 'success');
            } else {
                alert('Form saved as draft');
            }
        }

        function generatePDF() {
            console.log('Starting PDF generation...');
            
            // Try multiple ways to access jsPDF
            let jsPDF = null;
            let doc = null;
            
            // Method 1: Try window.jspdf
            if (typeof window.jspdf !== 'undefined') {
                console.log('Using window.jspdf');
                jsPDF = window.jspdf.jsPDF;
            }
            // Method 2: Try window.jsPDF
            else if (typeof window.jsPDF !== 'undefined') {
                console.log('Using window.jsPDF');
                jsPDF = window.jsPDF;
            }
            // Method 3: Try global jsPDF
            else if (typeof jsPDF !== 'undefined') {
                console.log('Using global jsPDF');
                jsPDF = window.jsPDF;
            }
            else {
                console.error('jsPDF library not found');
                alert('PDF library not loaded. Please refresh the page and try again.');
                return;
            }
            
            try {
                console.log('Creating PDF document...');
                doc = new jsPDF();
                console.log('PDF document created successfully');
            
                // Add title
                doc.setFontSize(20);
                doc.text('Admission Application Form', 20, 20);
                doc.setFontSize(12);
                doc.text('Institute of Tourism and Hospitality Management', 20, 30);
                
                // Add form data
                const formData = new FormData(document.getElementById('admissionForm'));
                const data = Object.fromEntries(formData);
                console.log('Form data collected:', data);
                
                let y = 50;
                
                // Add basic form data first
                addFormDataToPDF(doc, data, y);
                
                // Try to add photo if available
                const photoInput = document.getElementById('passport-photo');
                if (photoInput && photoInput.files && photoInput.files[0]) {
                    console.log('Photo file found, attempting to add to PDF...');
                    try {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const img = new Image();
                                img.onload = function() {
                                    // Add the image to PDF
                                    doc.addImage(e.target.result, 'JPEG', 140, 50, 60, 60);
                                    console.log('Image added to PDF');
                                    
                                    // Save the PDF
                                    doc.save('admission-application.pdf');
                                    showNotification('PDF generated successfully with photo!', 'success');
                                };
                                img.src = e.target.result;
                            } catch (error) {
                                console.error('Error adding image to PDF:', error);
                                // Save without image
                                doc.save('admission-application.pdf');
                                showNotification('PDF generated without photo due to image error', 'warning');
                            }
                        };
                        reader.readAsDataURL(photoInput.files[0]);
                    } catch (error) {
                        console.error('Error processing photo:', error);
                        // Save without image
                        doc.save('admission-application.pdf');
                        showNotification('PDF generated without photo', 'warning');
                    }
                } else {
                    console.log('No photo uploaded, saving PDF without photo');
                    // Save the PDF
                    doc.save('admission-application.pdf');
                    showNotification('PDF generated successfully!', 'success');
                }
                
            } catch (error) {
                console.error('Error in generatePDF function:', error);
                showNotification('Error generating PDF: ' + error.message, 'error');
                alert('Error generating PDF: ' + error.message);
            }
        }
        
        function addFormDataToPDF(doc, data, startY) {
            let y = startY;
            
            doc.setFontSize(14);
            doc.text('Personal Information:', 20, y);
            y += 10;
            
            doc.setFontSize(10);
            doc.text(`Name: ${data.full_name || ''}`, 20, y);
            y += 5;
            doc.text(`CNIC: ${data.cnic || ''}`, 20, y);
            y += 5;
            doc.text(`Date of Birth: ${data.date_of_birth || ''}`, 20, y);
            y += 5;
            doc.text(`Gender: ${data.gender || ''}`, 20, y);
            y += 5;
            doc.text(`Phone: ${data.phone || ''}`, 20, y);
            y += 5;
            doc.text(`Email: ${data.email || ''}`, 20, y);
            y += 5;
            doc.text(`Address: ${data.address || ''}`, 20, y);
            y += 10;
            
            doc.setFontSize(14);
            doc.text('Guardian Information:', 20, y);
            y += 10;
            
            doc.setFontSize(10);
            doc.text(`Guardian Name: ${data.guardian_name || ''}`, 20, y);
            y += 5;
            doc.text(`Relation: ${data.guardian_relation || ''}`, 20, y);
            y += 5;
            doc.text(`Phone: ${data.guardian_phone || ''}`, 20, y);
            y += 5;
            doc.text(`Occupation: ${data.guardian_occupation || ''}`, 20, y);
            y += 10;
            
            doc.setFontSize(14);
            doc.text('Academic Information:', 20, y);
            y += 10;
            
            doc.setFontSize(10);
            doc.text(`Matric Marks: ${data.matric_marks || ''}/${data.matric_total || ''}`, 20, y);
            y += 5;
            doc.text(`Intermediate Marks: ${data.intermediate_marks || ''}/${data.intermediate_total || ''}`, 20, y);
            y += 10;
            
            // Bachelor's Degree
            if (data.bachelor_degree || data.bachelor_institution) {
                doc.setFontSize(12);
                doc.text('Bachelor\'s Degree:', 20, y);
                y += 8;
                doc.setFontSize(10);
                if (data.bachelor_degree) doc.text(`Degree: ${data.bachelor_degree}`, 20, y);
                y += 5;
                if (data.bachelor_institution) doc.text(`Institution: ${data.bachelor_institution}`, 20, y);
                y += 5;
                if (data.bachelor_year) doc.text(`Year: ${data.bachelor_year}`, 20, y);
                y += 5;
                if (data.bachelor_cgpa) doc.text(`CGPA: ${data.bachelor_cgpa}`, 20, y);
                y += 10;
            }
            
            // Master's Degree
            if (data.master_degree || data.master_institution) {
                doc.setFontSize(12);
                doc.text('Master\'s Degree:', 20, y);
                y += 8;
                doc.setFontSize(10);
                if (data.master_degree) doc.text(`Degree: ${data.master_degree}`, 20, y);
                y += 5;
                if (data.master_institution) doc.text(`Institution: ${data.master_institution}`, 20, y);
                y += 5;
                if (data.master_year) doc.text(`Year: ${data.master_year}`, 20, y);
                y += 5;
                if (data.master_cgpa) doc.text(`CGPA: ${data.master_cgpa}`, 20, y);
                y += 10;
            }
            
            doc.setFontSize(14);
            doc.text('Declaration:', 20, y);
            y += 10;
            
            doc.setFontSize(10);
            doc.text(`Digital Signature: ${data.digital_signature || ''}`, 20, y);
            y += 5;
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, y);
            
            if (typeof showNotification === 'function') {
                showNotification('PDF generated successfully with photo', 'success');
            }
        }

        // Handle form submission
        // Enhanced form validation
        function validateForm() {
            const requiredFields = [
                'full_name', 'email', 'phone', 'cnic', 'date_of_birth', 'gender',
                'guardian_name', 'guardian_relation', 'guardian_phone',
                'matric_marks', 'matric_total', 'intermediate_marks', 'intermediate_total',
                'information_accurate', 'agree_to_terms', 'agree_to_verification'
            ];
            
            let isValid = true;
            const errors = [];
            
            // Check required fields
            requiredFields.forEach(field => {
                const element = document.querySelector(`[name="${field}"]`);
                if (!element || !element.value.trim()) {
                    isValid = false;
                    errors.push(`${field.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())} is required`);
                    if (element) {
                        element.classList.add('border-red-500');
                        element.classList.remove('border-gray-200');
                    }
                } else {
                    if (element) {
                        element.classList.remove('border-red-500');
                        element.classList.add('border-gray-200');
                    }
                }
            });
            
            // Email validation
            const email = document.querySelector('[name="email"]');
            if (email && email.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
                isValid = false;
                errors.push('Please enter a valid email address');
                email.classList.add('border-red-500');
            }
            
            // Phone validation
            const phone = document.querySelector('[name="phone"]');
            if (phone && phone.value && !/^[0-9+\-\s()]+$/.test(phone.value)) {
                isValid = false;
                errors.push('Please enter a valid phone number');
                phone.classList.add('border-red-500');
            }
            
            // CNIC validation
            const cnic = document.querySelector('[name="cnic"]');
            if (cnic && cnic.value && !/^[0-9]{5}-[0-9]{7}-[0-9]{1}$/.test(cnic.value)) {
                isValid = false;
                errors.push('CNIC must be in format: 12345-1234567-1');
                cnic.classList.add('border-red-500');
            }
            
            // Academic marks validation
            const matricMarks = parseFloat(document.querySelector('[name="matric_marks"]')?.value || 0);
            const matricTotal = parseFloat(document.querySelector('[name="matric_total"]')?.value || 0);
            const intermediateMarks = parseFloat(document.querySelector('[name="intermediate_marks"]')?.value || 0);
            const intermediateTotal = parseFloat(document.querySelector('[name="intermediate_total"]')?.value || 0);
            
            if (matricMarks > matricTotal) {
                isValid = false;
                errors.push('Matric marks cannot be greater than total marks');
            }
            
            if (intermediateMarks > intermediateTotal) {
                isValid = false;
                errors.push('Intermediate marks cannot be greater than total marks');
            }
            
            // Show validation errors
            if (!isValid) {
                showValidationErrors(errors);
            }
            
            return isValid;
        }
        
        // Show validation errors
        function showValidationErrors(errors) {
            const errorContainer = document.getElementById('validation-errors');
            if (!errorContainer) {
                const container = document.createElement('div');
                container.id = 'validation-errors';
                container.className = 'bg-red-50 border border-red-200 rounded-lg p-4 mb-6';
                container.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <ul class="list-disc list-inside space-y-1">
                                    ${errors.map(error => `<li>${error}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                document.querySelector('form').insertBefore(container, document.querySelector('form').firstChild);
            } else {
                errorContainer.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <ul class="list-disc list-inside space-y-1">
                                    ${errors.map(error => `<li>${error}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Clear validation errors
        function clearValidationErrors() {
            const errorContainer = document.getElementById('validation-errors');
            if (errorContainer) {
                errorContainer.remove();
            }
        }
        
        // Real-time validation
        function setupRealTimeValidation() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                input.addEventListener('input', function() {
                    if (this.classList.contains('border-red-500')) {
                        validateField(this);
                    }
                });
            });
        }
        
        function validateField(field) {
            const value = field.value.trim();
            let isValid = true;
            
            // Required field check
            if (field.hasAttribute('required') && !value) {
                isValid = false;
            }
            
            // Email validation
            if (field.type === 'email' && value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                isValid = false;
            }
            
            // Phone validation
            if (field.name === 'phone' && value && !/^[0-9+\-\s()]+$/.test(value)) {
                isValid = false;
            }
            
            // CNIC validation
            if (field.name === 'cnic' && value && !/^[0-9]{5}-[0-9]{7}-[0-9]{1}$/.test(value)) {
                isValid = false;
            }
            
            // Update field appearance
            if (isValid) {
                field.classList.remove('border-red-500');
                field.classList.add('border-gray-200');
            } else {
                field.classList.add('border-red-500');
                field.classList.remove('border-gray-200');
            }
            
            return isValid;
        }
        
        // Initialize real-time validation
        setupRealTimeValidation();
        
        // Test function to check photo upload
        function testPhotoUpload() {
            const photoInput = document.getElementById('passport-photo');
            if (photoInput && photoInput.files && photoInput.files[0]) {
                const file = photoInput.files[0];
                showNotification(`Photo detected: ${file.name} (${file.size} bytes, ${file.type})`, 'success');
                console.log('Photo file details:', {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                });
            } else {
                showNotification('No photo uploaded. Please select a photo first.', 'warning');
            }
        }
        
        // Simple test PDF generation
        function testSimplePDF() {
            console.log('Testing simple PDF generation...');
            
            // Try multiple ways to access jsPDF
            let jsPDF = null;
            
            if (typeof window.jspdf !== 'undefined') {
                jsPDF = window.jspdf.jsPDF;
            } else if (typeof window.jsPDF !== 'undefined') {
                jsPDF = window.jsPDF;
            } else {
                alert('jsPDF library not loaded!');
                return;
            }
            
            try {
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('Test PDF Generation', 20, 20);
                doc.setFontSize(12);
                doc.text('This is a test PDF to verify jsPDF is working.', 20, 30);
                doc.text('Generated at: ' + new Date().toLocaleString(), 20, 40);
                
                doc.save('test-pdf.pdf');
                showNotification('Test PDF generated successfully!', 'success');
                console.log('Test PDF generated successfully');
            } catch (error) {
                console.error('Error generating test PDF:', error);
                alert('Error generating test PDF: ' + error.message);
            }
        }
        
        // Alternative HTML-to-PDF method
        function generateHTMLPDF() {
            console.log('Using HTML-to-PDF method...');
            
            try {
                // Get form data
                const formData = new FormData(document.getElementById('admissionForm'));
                const data = Object.fromEntries(formData);
                
                // Create HTML content
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Admission Application Form</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { text-align: center; margin-bottom: 30px; }
                            .section { margin-bottom: 20px; }
                            .field { margin-bottom: 10px; }
                            .label { font-weight: bold; }
                            .photo { float: right; width: 100px; height: 100px; border: 1px solid #ccc; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>Admission Application Form</h1>
                            <h2>Institute of Tourism and Hospitality Management</h2>
                        </div>
                        
                        <div class="section">
                            <h3>Personal Information</h3>
                            <div class="field"><span class="label">Name:</span> ${data.full_name || ''}</div>
                            <div class="field"><span class="label">CNIC:</span> ${data.cnic || ''}</div>
                            <div class="field"><span class="label">Date of Birth:</span> ${data.date_of_birth || ''}</div>
                            <div class="field"><span class="label">Gender:</span> ${data.gender || ''}</div>
                            <div class="field"><span class="label">Phone:</span> ${data.phone || ''}</div>
                            <div class="field"><span class="label">Email:</span> ${data.email || ''}</div>
                            <div class="field"><span class="label">Address:</span> ${data.address || ''}</div>
                        </div>
                        
                        <div class="section">
                            <h3>Guardian Information</h3>
                            <div class="field"><span class="label">Guardian Name:</span> ${data.guardian_name || ''}</div>
                            <div class="field"><span class="label">Relation:</span> ${data.guardian_relation || ''}</div>
                            <div class="field"><span class="label">Phone:</span> ${data.guardian_phone || ''}</div>
                            <div class="field"><span class="label">Occupation:</span> ${data.guardian_occupation || ''}</div>
                        </div>
                        
                        <div class="section">
                            <h3>Academic Information</h3>
                            <div class="field"><span class="label">Matric Marks:</span> ${data.matric_marks || ''}/${data.matric_total || ''}</div>
                            <div class="field"><span class="label">Intermediate Marks:</span> ${data.intermediate_marks || ''}/${data.intermediate_total || ''}</div>
                        </div>
                        
                        <div style="clear: both;"></div>
                        <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #666;">
                            Generated on: ${new Date().toLocaleString()}
                        </div>
                    </body>
                    </html>
                `;
                
                // Create a new window with the HTML content
                const printWindow = window.open('', '_blank');
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                
                // Wait for content to load, then print
                printWindow.onload = function() {
                    printWindow.print();
                    showNotification('PDF generation initiated via print dialog!', 'success');
                };
                
            } catch (error) {
                console.error('Error in HTML PDF generation:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }
        
        // Alternative PDF generation method
        function generatePDFAlternative() {
            console.log('Using alternative PDF generation method...');
            
            try {
                const doc = new window.jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Admission Application Form', 20, 20);
                doc.setFontSize(12);
                doc.text('Institute of Tourism and Hospitality Management', 20, 30);
                
                // Add form data
                const formData = new FormData(document.getElementById('admissionForm'));
                const data = Object.fromEntries(formData);
                
                let y = 50;
                
                // Add basic form data
                doc.setFontSize(14);
                doc.text('Personal Information:', 20, y);
                y += 10;
                
                doc.setFontSize(10);
                doc.text(`Name: ${data.full_name || ''}`, 20, y);
                y += 5;
                doc.text(`CNIC: ${data.cnic || ''}`, 20, y);
                y += 5;
                doc.text(`Email: ${data.email || ''}`, 20, y);
                y += 5;
                doc.text(`Phone: ${data.phone || ''}`, 20, y);
                y += 10;
                
                // Add photo placeholder
                doc.setFontSize(10);
                doc.text('Passport Photo: [Photo would be here]', 140, 50);
                
                // Save the PDF
                doc.save('admission-application.pdf');
                showNotification('PDF generated successfully (alternative method)!', 'success');
                console.log('PDF generated successfully using alternative method');
                
            } catch (error) {
                console.error('Error in alternative PDF generation:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }
        
        document.getElementById('admissionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Clear previous errors
            clearValidationErrors();
            
            // Validate form
            if (!validateForm()) {
                // Scroll to first error
                const firstError = document.querySelector('.border-red-500');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
                return;
            }
            
            // Show loading state
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;
            
            // Simulate form processing
            setTimeout(() => {
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
            
            // Create new application
            const newApplication = {
                id: 'ADM' + Date.now(),
                intake_id: 1,
                student_name: data.full_name,
                student_email: data.email,
                student_phone: data.phone,
                status: 'pending_review',
                submitted_by: 'student',
                submitted_by_id: 5,
                submitted_at: new Date().toISOString(),
                personal_info: {
                    full_name: data.full_name,
                    cnic: data.cnic,
                    date_of_birth: data.date_of_birth,
                    gender: data.gender,
                    phone: data.phone,
                    email: data.email,
                    address: data.address
                },
                guardian_info: {
                    guardian_name: data.guardian_name,
                    guardian_relation: data.guardian_relation,
                    guardian_phone: data.guardian_phone,
                    guardian_occupation: data.guardian_occupation
                },
                academic_info: {
                    matric_marks: data.matric_marks,
                    matric_total: data.matric_total,
                    intermediate_marks: data.intermediate_marks,
                    intermediate_total: data.intermediate_total,
                    bachelor_degree: data.bachelor_degree,
                    bachelor_institution: data.bachelor_institution,
                    bachelor_year: data.bachelor_year,
                    bachelor_cgpa: data.bachelor_cgpa,
                    master_degree: data.master_degree,
                    master_institution: data.master_institution,
                    master_year: data.master_year,
                    master_cgpa: data.master_cgpa
                },
                undertaking: {
                    information_accurate: data.information_accurate,
                    agree_to_terms: data.agree_to_terms,
                    agree_to_verification: data.agree_to_verification,
                    digital_signature: data.digital_signature
                }
            };
            
            // Add to demo data
            if (demoData.admissionForms) {
                demoData.admissionForms.push(newApplication);
            }
            
                // Show enhanced success message
                showSuccessMessage();
                
                // Update status
                document.getElementById('application-status').textContent = 'SUBMITTED';
                document.getElementById('application-status').className = 'text-green-600';
                
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 2000);
        });
        
        // Show success message with animation
        function showSuccessMessage() {
            const successModal = document.createElement('div');
            successModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            successModal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl transform transition-all duration-300 scale-0" id="success-modal">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">Application Submitted!</h3>
                        <p class="text-gray-600 mb-6">Your application has been successfully submitted and is now under review.</p>
                        <div class="space-y-2 text-sm text-gray-500 mb-6">
                            <p>• You will receive an email confirmation shortly</p>
                            <p>• Application ID: ADM${Date.now()}</p>
                            <p>• Status: Pending Review</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                Close
                            </button>
                            <button onclick="generatePDF(); this.parentElement.parentElement.parentElement.remove()" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                Download PDF
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            // Animate modal
            setTimeout(() => {
                const modal = document.getElementById('success-modal');
                if (modal) {
                    modal.classList.remove('scale-0');
                    modal.classList.add('scale-100');
                }
            }, 100);
        }
    </script>
</body>
</html>
